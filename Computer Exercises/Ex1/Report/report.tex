\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\title{
	Computer Exercise 1\\
	EL2520 Control Theory and Practice
}
\author{
	Sifan Jiang\\
	sifanj@kth.se\\
	961220-8232
	\and
	Jiaqi Li\\
	jiaqli@kth.se\\
	960326-1711
}

\newcommand{\image}[3]{
	\begin{figure}[!ht]
		\centering
	    \includegraphics[width=#1\textwidth]{#2}
		\caption{#3}
		\label{fig:#2}
	\end{figure}
}

% My packages
\usepackage{algorithm, algorithmic, listings} % Code
\usepackage{amsmath, amstext, amssymb, amsfonts, amsthm, dsfont, cancel, gensymb, mathtools, textcomp} % Math
\usepackage{color, xcolor} % Color
\usepackage{diagbox, tabularx} % Table
\usepackage{enumerate} % List
\usepackage{epsfig, epstopdf, graphicx, multicol, multirow, palatino, pgfplots, subcaption, tikz} % Image.
\usepackage{fancybox}
\usepackage{verbatim}

% \usepackage[font=footnotesize]{caption} % labelfont=bf
% \usepackage[font=scriptsize]{subcaption} % labelfont=bf
\usepackage[margin=1in]{geometry}
\usepackage[hidelinks]{hyperref}
\epstopdfsetup{outdir=./Figure/Converted/}
\graphicspath{{./Figure/}}

\makeatletter
\def\input@path{{./Figure/}}
\makeatother

\pgfplotsset{compat=1.13}

\begin{document}
\maketitle

\section{Exercises}
\subsection{Basics}
\image{0.75}{system}{$F$-controller, $G$-system, $r$-reference signal, $u$-control signal, $d$-disturbance signal, $y$-output signal, $n$-measurement noise.}

\par Consider a system which can be modeled by the transfer function
\begin{align*}
	G(s) &= \frac{3(-s+1)}{(5s+1)(10s+1)}
\end{align*}
\begin{enumerate}
	\item \textbf{Question:} Use the procedure introduced in the basic course to construct a lead-lag controller which eliminates the static control error for a step response in the reference signal.
	\begin{align*}
		F(s) &= K\underbrace{\frac{\tau_{D}s+1}{\beta\tau_{D}s+1}}_{\mathrm{Lead}}\underbrace{\frac{\tau_{I}s+1}{\tau_{I}s+\gamma}}_{\mathrm{Lag}}
	\end{align*}
	\par The phase margin should be $30\degree$ at the cross-over frequency $\omega_{c}=0.4$ rad/s.
	\par \textbf{Answer:} For the closed-loop system, in order to have a phase margin $\phi_{m}=30\degree$, a cross-over frequency $\omega_{c}=0.4$ rad/s, and zero steady-state error for a step response in the reference signal, we consider a lead-lag controller $F$ shown above, where $K$, $\tau_{D}$, $\tau_{I}$, $\beta$, and $\gamma$ are parameters should be configured so that the closed-loop system satisfies the requirements.
	\par For a step reference, the error is given by
	\begin{align*}
		E(s) = R(s) - Y(s) = \frac{1}{1+F(s)G(s)}R(s) = \frac{1}{1+F(s)G(s)}\frac{1}{s}
	\end{align*}
	\par The steady-state error then can be obtained using Final Value Theorem:
	\begin{align*}
		e(\infty) = \lim_{t\rightarrow 0}e(t) = \lim_{s\rightarrow 0} sE(s) = \frac{1}{1+F(0)G(0)} = \frac{\gamma}{\gamma + 3K}
	\end{align*}
	\par To get zero steady-state error, $e(\infty) = 0$, either $\gamma = 0$ or $K \rightarrow \infty$. So, $\gamma = 0$ is chosen here.
	\par Then we can design the lag controller. To minimize the phase lag caused by the lag compensator, we would obtain:
	\begin{align*}
		\tau_{I} = \frac{10}{\omega_{c}} = \frac{10}{0.4} = 25
	\end{align*}
	then the lag component becomes to $F_{I}(s) = \frac{25s+1}{25s}$, and the phase margin of $F_{I}(s)G(s)$ is equal to 
	
	\par In all, we have our controller:
	\begin{align*}
		F(s) = 
	\end{align*}
	
	\item \textbf{Question:} 
	\par \textbf{Answer:}
	
	\item \textbf{Question:} 
	\par \textbf{Answer:} 
\end{enumerate}


\subsection{Disturbance attenuation}
\image{0.75}{system2}{$F_{r}$-prefilter, $F_{y}$-feedback controller, $G$-system, $G_{d}$-disturbance dynamics, $r$-reference signal, $u$-control signal, $d$-disturbance signal, $y$-measurement signal.}

\par The block diagram of the control system is given in fig~\ref{fig:system2}, where the transfer functions have been estimated to
\begin{align*}
	G(s) &= \frac{20}{(s+1)((\frac{s}{20})^{2}+\frac{s}{20}+1)} \\
	G_{d}(s) &= \frac{10}{s+1}
\end{align*}

%\par The exercise is about designing $F_{r}$ and $F_{y}$ in fig~\ref{fig:system2} such that:\begin{itemize}\item The rise time for a step change in the reference signal less than $0.2$ s and the overshoot is less than 10\%.\item For a step in the disturbance, we have $\vert y(t) \vert \leq 1$ $\forall t$ and $\vert y(t) \vert \leq 0.1$ for $t > 0.5$ s.\item Since the signals are scaled the control signal obeys $\vert u(t) \vert \leq 1$ $\forall t$.\end{itemize}

\begin{enumerate}
	\item \textbf{Question:} For which frequencies is control action needed? Control is needed at least at frequencies where $\vert G_{d}(j\omega) \vert > 1$ in order for disturbances to be attenuated. Therefore the cross-over frequency must be large enough. First, try to design $F_{y}$ such that $L(s) \approx \omega_{c} / s$ and plot the closed-loop transfer function from $d$ to $y$ and the corresponding step response. (A simple way to find $L(s) = \omega_{c} / s$ is to let $F_{y} = G^{-1} \omega_{c} / s$. However, this controller is not proper. A procedure to fix this is to ``add'' a number of poles in the controller such that it becomes proper. How should these poles be chosen?)
	\par \textbf{Answer:} $\omega_{c} = 9.9473$ rad/s is the cross-over frequency of $G_{d}$ so that $G_{d}(j\omega_{c}) = 1$. And since control is needed at least at frequencies where $\vert G_{d}(j\omega) \vert > 1$, $\omega \in [0, 9.9473]$ rad/s is the frequencies which control action needed.
	\par To design $F_{y}$ such that $L_{s} \approx \omega_{c} / s$, a naive approach can be first considered:
	\begin{align*}
		F_{y}^{*}(s) &= G^{-1}(s) \omega_{c} / s \\
		&= \frac{(s+1)((\frac{s}{20})^{2}+\frac{s}{20}+1)\omega_{c}}{20s}
	\end{align*}
	so that $L(s) = F_{y}^{*}(s) G(s) = \omega_{c} / s$. However, the relative degree of $F_{y}^{*}$ is $-2$, meaning future information in time domain would be needed, which is impossible. So poles such be ``added'' to make the controller proper.
\end{enumerate}

\par The feedback controller in exercise 4.2.2 is
\begin{align*}
	F_{y}(s) &= \ldots
\end{align*}

	\image{0.5}{system}{Step disturbance, exercise 4.2.2}
	
	The feedback controller and prefilter in exercise 4.2.3 is 
	\[
	F_y(s) = \ldots
	\]
	\[
	F_r(s) = \ldots
	\]
	\image{0.25}{system}{Reference step, exercise 4.2.3}
	\image{0.25}{system}{Control signal for a disturbance or a reference step (plus a combination of these)}

	Did you manage to fulfill all the specifications? If not, what do you think makes the specifications difficult to achieve?
	\par\dotfill\par\dotfill\par
	
	\image{0.25}{system}{Bode diagram of sensitivity and complementary sensitivity functions, exercise 4.2.4}

\end{document}
